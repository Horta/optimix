language: python
matrix:
  include:
  - os: linux
    sudo: false
    dist: trusty
    python: '2.7'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.4'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.5'
  - os: osx
    language: generic
    env: TRAVIS_PYTHON_VERSION=3.5
before_install:
- wget https://raw.githubusercontent.com/Horta/travis-miniconda/master/install.sh
  -O install.sh
- chmod +x install.sh
- travis_retry bash -x ./install.sh
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
before_script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py test
script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py sdist
- pip install dist/`ls dist | grep -i -E '\.(gz)$' | head -1`
- pushd /
- python -c "import optimix; optimix.test()"
- popd
deploy:
  provider: pypi
  skip_cleanup: true
  user: danilo.horta
  on:
    branch: master
  password:
    secure: DWzf3hAggNQIZXXKDfxxArrq/Y7Gb7eKIsRsyw1BswFepA+UDm6SCINcDn3uqN1erOErGTwpasvbEF28ZEWcBzUiUlG8SLcICWiFMiRcWuRB5ICpekrQRh8NCpTahHONy1RbslnRavG2PC8neX++XOocd80JD2njo5opC4LYcsDz3oh54drvmASh0XHQPgfpLadnUofkAgHVmhu8GdJI+Yrmh+khr0UHJr5zYFuMIX6Mjbf4gp9gzrvrc+jrWzG3t6+oDoT6elP/O2UBYmVZffnYgnuOBMUHurzHGXXvMek+WJV8Px5IjeoCJA8+cIP0MnFtIbTCfLGstckZ8II3VCoC7llHhkS+FV7HYP/SGWY4KK7eaAwo509WBGKO2G+kHDIYybIUn6sVFAeRt7Gp+AR4kjdnCHYcKLTKMwsUhLUCQv6EzZbwLRz3TKuk59F+BFdXPlmEpk2UZG4uLNCrA1hWiTnaM2w5EM69BaB/ffw6VhiEut1aCAxJvpwjJDI7cBvePd0IbaS9Gj+JGoh0Zy2JRTbppdyJjug2cbglLw5AwagueMsNN8tIjQh7mtFQFOsFL5TbnkfOSZ9ERagJvD6yEgl0tjYVIW6vpsPfPFR/j+qfNeNVjEAWjvvM86FlYUMyFxX4/4e7ANwfsz1k6XwUeTwrjdl/12ITNDcsseY=
notifications:
  email: false
